<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Laravel模块化开发 - 莱恩哈特的记事本</title>
  <link rel="alternate" hreflang="zh-cn" href="https://mustang1988.github.io/" />

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="MustangGu" />
  <meta name="description" content="Laravel项目的基本目录结构 使用composer初始化一个laravel项目 #composer create-project laravel/laravel MyLaravelProject 初始化完成后观察目录结构基本如下: . ├── app │ ├──" />







<meta name="generator" content="Hugo 0.37.1" />


<link rel="canonical" href="https://mustang1988.github.io/post/laravel%E6%A8%A1%E5%9D%97%E5%8C%96%E6%8B%86%E5%88%86/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" href="/favicon.ico" />
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">




<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">




<meta property="og:title" content="Laravel模块化开发" />
<meta property="og:description" content="Laravel项目的基本目录结构 使用composer初始化一个laravel项目 #composer create-project laravel/laravel MyLaravelProject 初始化完成后观察目录结构基本如下: . ├── app │ ├──" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mustang1988.github.io/post/laravel%E6%A8%A1%E5%9D%97%E5%8C%96%E6%8B%86%E5%88%86/" />



<meta property="article:published_time" content="2017-11-27T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2017-11-27T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Laravel模块化开发">
<meta itemprop="description" content="Laravel项目的基本目录结构 使用composer初始化一个laravel项目 #composer create-project laravel/laravel MyLaravelProject 初始化完成后观察目录结构基本如下: . ├── app │ ├──">


<meta itemprop="datePublished" content="2017-11-27T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2017-11-27T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="3571">



<meta itemprop="keywords" content="Laravel,PHP," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Laravel模块化开发"/>
<meta name="twitter:description" content="Laravel项目的基本目录结构 使用composer初始化一个laravel项目 #composer create-project laravel/laravel MyLaravelProject 初始化完成后观察目录结构基本如下: . ├── app │ ├──"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">莱恩哈特的记事本</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">莱恩哈特的记事本</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Laravel模块化开发</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-11-27 </span>
        <div class="post-category">
            
              <a href="/categories/laravel/"> Laravel </a>
            
              <a href="/categories/php/"> PHP </a>
            
          </div>
        <span class="more-meta"> 约 3571 字 </span>
        <span class="more-meta"> 预计阅读 8 分钟 </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content always-active">
    
  </div>
</div>

    
    <div class="post-content">
      <ol>
<li><p>Laravel项目的基本目录结构</p>

<p>使用composer初始化一个laravel项目</p>

<pre><code class="language-shell">#composer create-project laravel/laravel MyLaravelProject
</code></pre>

<p>初始化完成后观察目录结构基本如下:</p>

<pre><code class="language-shell">  .
  ├── app
  │    ├── Console
  │    │    └── Kernel.php
  │    ├── Exceptions
  │    │    └── Handler.php
  │    ├── Http
  │    │    ├── Controllers
  │    │    │    ├── Auth
  │    │    │    └── Controller.php
  │    │    ├── Kernel.php
  │    │    └── Middleware
  │    │        ├── EncryptCookies.php
  │    │        ├── RedirectIfAuthenticated.php
  │    │        ├── TrimStrings.php
  │    │        ├── TrustProxies.php
  │    │        └── VerifyCsrfToken.php
  │    ├── Providers
  │    │    ├── AppServiceProvider.php
  │    │    ├── AuthServiceProvider.php
  │    │    ├── BroadcastServiceProvider.php
  │    │    ├── EventServiceProvider.php
  │    │    └── RouteServiceProvider.php
  │    └── User.php
  ├── artisan
  ├── bootstrap
  │    ├── app.php
  │    └── cache
  │        ├── packages.php
  │        └── services.php
  ├── composer.json
  ├── composer.lock
  ├── config
  │    ├── app.php
  │    ├── auth.php
  │    ├── broadcasting.php
  │    ├── cache.php
  │    ├── database.php
  │    ├── filesystems.php
  │    ├── mail.php
  │    ├── queue.php
  │    ├── services.php
  │    ├── session.php
  │    └── view.php
  ├── database
  │    ├── factories
  │    ├── migrations
  │    └── seeds
  ├── package.json
  ├── phpunit.xml
  ├── public
  │    ├── css
  │    ├── favicon.ico
  │    ├── index.php
  │    ├── js
  │    ├── robots.txt
  │    └── web.config
  ├── readme.md
  ├── resources
  │    ├── assets
  │    ├── lang
  │    │    └── en
  │    │        ├── auth.php
  │    │        ├── pagination.php
  │    │        ├── passwords.php
  │    │        └── validation.php
  │    └── views
  │        └── welcome.blade.php
  ├── routes
  │    ├── api.php
  │    ├── channels.php
  │    ├── console.php
  │    └── web.php
  ├── server.php
  ├── storage
  ├── tests
  └── vendor
</code></pre>

<p>按照框架的约定,通常在开发中</p>

<ul>
<li>数据模型(models)会直接置于app目录下;</li>
<li>控制器(controllers)会置于app/Http/Controllers目录下;</li>
<li>路由配置(routers)会直接写在routes/api.php和web.php中</li>
<li>页面视图(views)会置于resource/views目录下</li>
<li>常量配置值(config)会置于config目录下
<br /></li>
</ul>

<p>实际开发中,一般都会按照框架的这些约定进行编码,这就导致了一些问题</p>

<ul>
<li>随着项目功能的增加,数据模型层中的类越来越多,相互之间的关联越来越多,也就越来越多的会出现数据模型的关联查询,这就存在一种隐患,如果想迁移部分或所有的数据模型层,从现有数据库到其他数据库,这些关联查询,君有可能发生严重的异常;</li>
<li>控制器类功能过于集中,无论是页面跳转的控制,还是数据接口的控制,都写在同一个类中,这导致控制器类的高度复杂,后期很难进行维护,这也不符合单一职责原则的要求;</li>
<li>路由配置过于集中,项目越胖大,涉及的路由地址越多,router配置文件就越复杂,难以维护,许多格式类似的路由,很难进行查询</li>
<li>页面视图文件集中在同一个目录下,命名冲突时有发生,只能通过不断的新建目录来分散文件</li>
<li>常量配置基本同上面,过于集中,debug过程中,需要频繁的在很多文件的目录中进行切换,效率大打折扣</li>
</ul></li>

<li><p>为什么要拆分模块化开发</p>

<p>正如前文分析的结果一样,按照框架约定的方式进行开发,会为后续的项目维护带来很大的不方便和维护成本的上升</p>

<p>因此将同一功能拆分成模块,将相关模块的代码文件集中组合在一起,独立维护,同时又对外暴露接口,允许其他模块顺利访问是最简单有效的办法</p></li>

<li><p>模块化拆分方案</p>

<ul>
<li><p>模块拆分准备</p>

<ul>
<li><p>创建模块根目录,用于存放拆分后的模块</p></li>

<li><p>在项目根目录,新建一个Modules目录;</p></li>

<li><p>为模块根目录设置根namespaces,laravel框架本身是完全遵循<a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a>标准进行类加载的,因此需要为模块目录设置根namespaces;</p>

<pre><code class="language-json">&quot;autoload&quot;: {
&quot;classmap&quot;: [
    &quot;database&quot;
],
&quot;psr-4&quot;: {
    &quot;App\\&quot;: &quot;app/&quot;,
    &quot;Modules\\&quot;:&quot;Modules/&quot;
}
},
</code></pre></li>

<li><p>laravel的<a href="http://www.php-fig.org/psr/psr-4/">PSR-4</a>是通过composer-autoload实现的,因此在配置好模块的根namespaces后,一定需要重建composer的autoload,使得在运行过程中,模块中的类可以被正常的autoload</p></li>
</ul>

<pre><code class="language-shell">  #composer dump-autoload -o
</code></pre>

<ul>
<li><p>创建各个功能模块的独立目录</p></li>

<li><p>完成根namespaces的定以后就可以在Modules目录下,按照业务需要新建各个功能模块的独立目录了</p></li>
</ul></li>

<li><p>配置模块IOC注入</p>

<ul>
<li>在模块目录下新建Providers目录</li>
<li>在Providers目录中新建模块服务注入类,继承自框架的Illuminate\Support\ServiceProvider类</li>
</ul></li>
</ul>

<pre><code class="language-php">  &lt;?php

    namespace Modules\模块名称\Providers;

    use Illuminate\Support\ServiceProvider;

    class ModuleServiceProvider extends ServiceProvider
    {
        private $module_name = '模块名称';

        public function register()
        {
            $this-&gt;binds();
        }

        public function boot()
        {

        }

        private function binds()
        {

        }
    }
</code></pre>

<ul>
<li>在框架核心配置文件config/app.php的providers数组中将新增的ModuleServiceProvider添加进去</li>
</ul>

<pre><code class="language-php">  &lt;?php
    ...
    'providers' =&gt; [
      ...
      Modules\模块名称\Providers\ModuleServiceProvider::class,
    ]
</code></pre>

<ul>
<li><p>拆分数据模型到模块</p>

<ul>
<li>在模块对应的目录下,新建Modules目录,用于放置当前模块相关的数据模型类;       * 注意,其中的数据模型类的namespaces一定要与先前设置的根namespace以及实际目录结构一致;
例如:
&gt; 数据模型类的namespaces应该为
&gt; Modules\模块名称\Models;</li>
</ul></li>

<li><p>拆分控制器到模块</p>

<ul>
<li>仿照laravel的app目录下控制器的存放目录新建Http/Controllers目录用于放置控制器类</li>
<li>同拆分数据模型类时类似,需要修改对应控制器类的namespaces
&gt; 控制器目录namespaces应该为
&gt; Modules\模块名称\Http\Controllers</li>
</ul></li>

<li><p>拆分路由配置到模块</p>

<ul>
<li>在模块目录下新建Routes目录用于放置路由配置文件,可以现在该Routers目录下新建api.php和web.php两个路由配置文件,分别用来配置api接口和web页面跳转的路由;</li>
<li>在模块的Provider目录新建路由配置注入类,继承自框架的Illuminate\Foundation\Support\Providers\RouteServiceProvider类
<br /></li>
</ul></li>
</ul>

<pre><code class="language-php">  &lt;?php

    namespace Modules\模块名称\Providers;

    use Illuminate\Foundation\Support\Providers\RouteServiceProvider;
    use Route;

    class ModuleRouterServiceProvider extends RouteServiceProvider
    {
        protected $namespace = 'Modules\模块名称\Http\Controllers';

        public function boot()
        {
            parent::boot();
        }

        public function map()
        {
            $this-&gt;mapApiRoutes();

            $this-&gt;mapWebRoutes();
        }

        protected function mapWebRoutes()
        {
            Route::group([
                'middleware' =&gt; 'web',
                'namespace' =&gt; $this-&gt;namespace,
            ], function ($router) {
                require base_path('Modules\模块名称/Routers/web.php');
            });
        }

        protected function mapApiRoutes()
        {
            Route::group([
                'middleware' =&gt; 'api',
                'namespace' =&gt; $this-&gt;namespace,
                'prefix' =&gt; 'api',
            ], function ($router) {
                require base_path('Modules\模块名称/Routers/api.php');
            });
        }
    }
</code></pre>

<ul>
<li>编辑之前创建的ModuleServiceProvider,在register方法中,调用路由注入类的register方法,将路由配置,关联到模块注入配置</li>
</ul>

<pre><code class="language-php">    &lt;?php 
    ...
    public function register()
    {
        $this-&gt;app-&gt;register(ModulesRouterServiceProvider::class);
        $this-&gt;binds();
    }
</code></pre>

<ul>
<li><p>拆分视图文件到模块</p>

<ul>
<li>在模块目录下新建Views目录,用于取代resource/views目录,放置页面模板和blade模板引擎文件</li>
<li>编辑之前创建的ModuleServiceProvider,boot方法中,将新增的视图目录,注入到框架的viewslocation中</li>
</ul></li>
</ul>

<pre><code class="language-php">    &lt;?php
    public function boot()
    {
        $view_location = sprintf('Modules/%s/Views', $this-&gt;module_name);
        View::addLocation(base_path($view_location));
    }
</code></pre>

<ul>
<li><p>拆分常量配置到模块</p>

<ul>
<li>在模块目录下新建Configs目录,用于存放模块独立的常量配置,建议每个模块只使用一个单独的常量配置</li>
<li>由于框架的加载机制,所有常量配置必须放置在configs目录下,才能正常被读取和使用,因此,拆分到模块Configs目录下的配置,在实际运行时还是要放置到configs目录下才能正常使用,为避免不必要的麻烦和自动化构建,框架本身提供了从指定的目录发布配置文件到configs目录的功能,在之前创建的ModuleServiceProvider中,在register方法中添加相关代码</li>
</ul></li>
</ul>

<pre><code class="language-php">    &lt;?php
    public function register()
    {
        $config_path = __DIR__ . '/../Configs';
        if (function_exists('config_path')) {
            $publish_path = config_path('');
        } else {
            $publish_path = base_path('config/');
        }
        $this-&gt;publishes([$config_path =&gt; $publish_path], 'config');
    }
</code></pre>

<ul>
<li><p>拆分模块服务到模块</p>

<ul>
<li>在模块目录下新建Services目录,根据业务需要,在其中开发具体的业务服务的接口和实现类</li>
<li>在模块的ModuleServiceProvider中的bind方法实现绑定实现类到接口实现DI和服务定位</li>
</ul></li>

<li><p>拆分其他组件到模块</p>

<ul>
<li>启发组件部分包括自定义异常,请求中间件,表单校验器等等,可以俺需要在模块目录下新建对应的Exceptions,Middlewares和Validators等目录</li>
</ul></li>
</ul></li>

<li><p>模块化拆分后的基本目录结构</p>

<ul>
<li>进行完上述的拆分过程后,完全模块化;模块代码独立目录管理的结构就完成了</li>
<li>最终呈现的目录结构大致如下</li>
</ul>

<pre><code class="language-shell">  .
  ├── Modules
  │    ├── 模块名称
  │    │    ├── Configs
  │    │    │    └── xxx.php
  │    │    ├── Console
  │    │    ├── Exceptions
  │    │    │    └── xxxException.php
  │    │    ├── Http
  │    │    │    ├── Controllers
  │    │    │    └── Middlewares
  │    │    ├── Models
  │    │    │    └── xxxModel.php
  │    │    ├── Providers
  │    │    │    ├── xxxRouteServiceProvider.php
  │    │    │    └── xxxServiceProvider.php
  │    │    ├── Routers
  │    │    │    ├── api.php
  │    │    │    └── web.php
  │    │    ├── Services
  │    │    │    ├── Ifaces
  │    │    │    └── Impls
  │    │    ├── Validations
  │    │    │    └── xxxValidation.php
  │    │    └── Views
</code></pre></li>

<li><p>模块化开发后部署上线的一些注意点</p>

<ul>
<li>由于拆分了配置文件到模块目录,因此项目上线时,必须先发布配置文件到config目录下</li>
</ul>

<pre><code class="language-shell">  # php artisan vender:publish --provider='Modules\模块名称\Providers\ModuleServiceProvider' --force
</code></pre>

<ul>
<li>这部分流程的执行是幂等的,可以加入到正常构建流程中,每次构建都执行,并不会有额外的影响</li>
<li>在每次执行vender:publish后,由于框架本身存在的配置缓存问题,会出现publish了新的配置,但是并没有生效,此时就需要手动去清除默认缓存起来的配置值</li>
</ul>

<pre><code class="language-shell">  #php artisan compile-clear
  #php artisan config:clear 
</code></pre></li>
</ol>

    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/laravel/">Laravel</a>
          
          <a href="/tags/php/">PHP</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/%E4%BD%BF%E7%94%A8dockerfile%E6%9E%84%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84docker%E9%95%9C%E5%83%8F/">
            <span class="next-text nav-default">使用Dockerfile构建自己的docker镜像</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
    

  

  

  <div id="comments-gitment"></div>
  <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
    <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
  <script type="text/javascript">
  const gitment = new Gitment({
    id: '2017-11-27 00:00:00 \x2b0000 UTC',
    title: 'Laravel模块化开发',
    link: decodeURI(location.href),
    desc: 'Laravel项目的基本目录结构 使用composer初始化一个laravel项目 #composer create-project laravel\/laravel MyLaravelProject 初始化完成后观察目录结构基本如下: . ├── app │ ├──',
    owner: 'mustang1988',
    repo: 'blog_comments',
    oauth: {
      client_id: '715d102db9b27b46ae34',
      client_secret: '482b32f1d86988137b9be6f5d54901f2598d0ca6'
    }
  })
  gitment.render('comments-gitment')
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>
  </article>
        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  <a href="https://mustang1988.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy; 
    
      2017 - 
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">MustangGu</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





</body>
</html>
